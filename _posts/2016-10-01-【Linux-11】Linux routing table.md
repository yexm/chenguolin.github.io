---
layout:  post    # 使用的布局（不需要改）
catalog: true   # 是否归档
author: 陈国林 # 作者
tags:         #标签
    - Linux
---

# 一. routing table
routing table 指的是路由表，所有的网络设备无论是主机、路由器还是其他设备都需要有配置决定如何将 TCP/IP 数据包路由到何处，路由表正是用来存储这些配置的。路由表包含一序列路由规则，当收到一个数据包的时候它会根据路由表规则决定把数据包发送到哪里去。除此之外，路由表还包含到其它目的地址的距离信息。路由表并不会包含所有的路由规则，它只会包含跟当前相邻的节点路由规则。

Linux routing table 是存储在内存中，路由表规则可以动态配置也可以静态配置。动态路由配置是通过动态路由协议自学习的方式，静态路由配置则一般由网络管理员配置。由于内存有限没有办法存储大量设备的路由信息，因此路由表中的路由规则使用的是IP段也就是[Classless Inter-Domain Routing (CIDR)](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing)的方式。

Linux下我们可以使用 route 命令查看当前内核的路由表，例如下面这个例子

```
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.65.1    0.0.0.0         UG    0      0        0 eth0
10.1.0.0        *               255.255.0.0     U     0      0        0 cni0
127.0.0.0       *               255.0.0.0       U     0      0        0 lo
172.17.0.0      *               255.255.0.0     U     0      0        0 docker0
192.168.65.0    *               255.255.255.0   U     0      0        0 eth0
```

重要的几个字段的含义如下
1. Destination: 目标网络或目标主机
2. Gateway: 网关地址 (*表示直连，不需要经过网关)
3. Genmask: 子网掩码
4. Flags: 相关标识 `U`表示路由规则可用，`G`表示网关，`H`表示目标是一个主机，`!`表示路由规则关闭
5. Iface: 网卡名称

这几行配置含义如下
1. 第一行: 默认路由规则，没有匹配到路由表规则的情况下使用默认路由规则，把数据包通过eth0发送到网关192.168.65.1
2. 第二行: 所有目标IP为10.1.0.0/16的数据包，都会通过cni0直接发送出去（不需要经过网关）
3. 第三行: 所有目标IP为127.0.0.0/8的数据包，都会通过lo直接发送出去（不需要经过网关）
4. 第四行: 所有目标IP为172.17.0.0/16的数据包，都会通过docker0直接发送出去（不需要经过网关）
5. 第五行: 所有目标IP为192.168.65.0/24的数据包，都会通过eth0直接发送出去（不需要经过网关）

# 二. route command
