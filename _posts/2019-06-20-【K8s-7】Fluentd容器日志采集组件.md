---
layout:  post  # 使用的布局（不需要改）
catalog: true  # 是否归档
author: 陈国林 # 作者
tags:          #标签
    - K8s
---

# 一. 概述
上一篇文章我们整体介绍了 [容器日志采集方案](https://chenguolin.github.io/2019/06/19/K8s-6-%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%96%B9%E6%A1%88/)，我们知道K8s集群的日志采集组件用的最多的是 `Fluentd`。关于 Fluentd 的详细介绍，可以参考以下文章。这篇文章，我会总结一下在K8s集群使用 Fluentd 进行容器日志采集的实现方案，以及相关的配置。

1. [Fluentd基础介绍](https://chenguolin.github.io/2019/02/26/Fluentd-1-Fluentd%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/)
2. [Fluentd命令介绍](https://chenguolin.github.io/2019/02/27/Fluentd-2-Fluentd%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D/)
3. [Fluentd插件介绍](https://chenguolin.github.io/2019/02/28/Fluentd-3-Fluentd%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D/)
4. [Fluentd使用举例](https://chenguolin.github.io/2019/03/01/Fluentd-4-Fluentd%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B/)
5. [Fluentd插件开发](https://chenguolin.github.io/2019/03/02/Fluentd-5-Fluentd%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/)
6. [Fluentd Prometheus监控](https://chenguolin.github.io/2019/03/05/Fluentd-6-Fluentd-Prometheus%E7%9B%91%E6%8E%A7/)
7. [Fluentd日志采集全链路方案](https://chenguolin.github.io/2019/03/07/Fluentd-7-Fluentd%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E5%85%A8%E9%93%BE%E8%B7%AF%E6%96%B9%E6%A1%88/)

# 二. 实现
Fluentd 整体的部署架构如下图所示，总体来说分为2部分。fluentd 相关的配置通过k8s configmap进行配置存储在 `master etcd`，fluentd 自身通过k8s daemonset 部署在每个worker节点上。采集完数据后实时输出到 Kafka，下游通过 ELK 进行处理、存储和数据查询。

![](https://github.com/chenguolin/chenguolin.github.io/blob/master/data/image/k8s-fluentd-agent.png?raw=true)

## configmap

## daemonset
